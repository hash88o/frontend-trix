<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TriX Gaming Platform - Tic-Tac-Toe</title>
    <script src="ethers-6.7.1.umd.min.js"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        color: #333;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
      }

      .card {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .header {
        grid-column: 1 / -1;
        text-align: center;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
      }

      .wallet-section {
        grid-column: 1 / -1;
      }

      .game-section {
        display: flex;
        flex-direction: column;
        min-height: 500px;
      }

      h1,
      h2,
      h3 {
        color: #5465f8;
        margin-bottom: 15px;
      }

      .btn {
        padding: 12px 24px;
        border: none;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        margin: 5px;
      }

      .btn-primary {
        background: linear-gradient(45deg, #5465f8, #667eea);
        color: white;
      }
      .btn-success {
        background: #28a745;
        color: white;
      }
      .btn-warning {
        background: #ffc107;
        color: #212529;
      }
      .btn-danger {
        background: #dc3545;
        color: white;
      }
      .btn:hover {
        transform: translateY(-2px);
        opacity: 0.9;
      }
      .btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }

      input[type="number"] {
        width: 100%;
        padding: 12px;
        border: 2px solid #e9ecef;
        border-radius: 8px;
        font-size: 1rem;
        margin: 10px 0;
      }

      input[type="number"]:focus {
        outline: none;
        border-color: #5465f8;
        box-shadow: 0 0 0 3px rgba(84, 101, 248, 0.1);
      }

      .status {
        padding: 12px;
        border-radius: 8px;
        margin: 10px 0;
        font-weight: 500;
      }

      .status.info {
        background: #d1ecf1;
        color: #0c5460;
      }
      .status.success {
        background: #d4edda;
        color: #155724;
      }
      .status.warning {
        background: #fff3cd;
        color: #856404;
      }
      .status.error {
        background: #f8d7da;
        color: #721c24;
      }

      .wallet-info {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        margin: 15px 0;
      }

      .balance-card {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        text-align: center;
      }

      .balance-label {
        font-size: 0.9rem;
        color: #666;
      }
      .balance-amount {
        font-size: 1.5rem;
        font-weight: bold;
        color: #5465f8;
      }

      .game-board {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 8px;
        max-width: 300px;
        margin: 20px auto;
        background: #5465f8;
        padding: 8px;
        border-radius: 12px;
      }

      .cell {
        aspect-ratio: 1;
        background: white;
        border: none;
        border-radius: 6px;
        font-size: 2.5rem;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #333;
      }

      .cell:hover:not(.disabled) {
        background: #f0f0f0;
        transform: scale(1.05);
      }
      .cell.disabled {
        cursor: not-allowed;
        opacity: 0.6;
      }
      .cell.x {
        color: #dc3545;
      }
      .cell.o {
        color: #28a745;
      }

      .match-info {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        margin: 15px 0;
      }

      .match-info p {
        margin: 8px 0;
        font-weight: 500;
      }

      .hidden {
        display: none !important;
      }

      .loading {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid #f3f3f3;
        border-top: 3px solid #5465f8;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-right: 10px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .tx-link {
        color: #5465f8;
        text-decoration: none;
        font-weight: 500;
      }

      .tx-link:hover {
        text-decoration: underline;
      }

      @media (max-width: 768px) {
        .container {
          grid-template-columns: 1fr;
          padding: 10px;
        }

        .game-board {
          max-width: 250px;
        }
        .cell {
          font-size: 2rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Header -->
      <div class="header card">
        <h1>ðŸŽ® TriX Gaming Platform - Tic-Tac-Toe</h1>
        <p>
          Blockchain-based competitive gaming with automated staking and payouts
        </p>
      </div>

      <!-- Wallet & Balance Section -->
      <div class="wallet-section card">
        <h2>ðŸ’° Wallet & Balance</h2>

        <!-- Connect Wallet -->
        <div id="connectSection">
          <button id="connectWallet" class="btn btn-primary">
            Connect MetaMask Wallet
          </button>
        </div>

        <!-- Wallet Info -->
        <div id="walletInfo" class="hidden">
          <p><strong>Address:</strong> <span id="walletAddress"></span></p>

          <div class="wallet-info">
            <div class="balance-card">
              <div class="balance-label">ETH Balance</div>
              <div class="balance-amount" id="ethBalance">0</div>
            </div>
            <div class="balance-card">
              <div class="balance-label">USDT Balance</div>
              <div class="balance-amount" id="usdtBalance">1000</div>
            </div>
            <div class="balance-card">
              <div class="balance-label">GT Balance</div>
              <div class="balance-amount" id="gtBalance">0</div>
            </div>
          </div>

          <!-- Buy GT Tokens -->
          <h3>Buy GT Tokens (1 USDT = 1 GT)</h3>
          <input
            type="number"
            id="usdtAmount"
            placeholder="Enter USDT amount"
            min="1"
          />
          <button id="buyGT" class="btn btn-success">Buy GT Tokens</button>
        </div>
      </div>

      <!-- Game Section -->
      <div class="game-section card">
        <h2>ðŸŽ¯ Tic-Tac-Toe Game</h2>

        <!-- Start Game Section -->
        <div id="startGameSection">
          <h3>Start a Match</h3>
          <p>
            Enter your stake amount to find an opponent with the same stake.
          </p>

          <input
            type="number"
            id="stakeAmount"
            placeholder="Stake amount (GT)"
            min="1"
          />
          <button id="findMatch" class="btn btn-warning">
            Find Match & Play
          </button>

          <div id="searchingStatus" class="status info hidden">
            <span class="loading"></span>
            Searching for opponent with same stake amount...
          </div>
        </div>

        <!-- Match Found Section -->
        <div id="matchFoundSection" class="hidden">
          <div class="status success">
            <strong>ðŸŽ‰ Match Found!</strong>
          </div>

          <div class="match-info">
            <p><strong>Opponent:</strong> <span id="opponentAddress"></span></p>
            <p><strong>Stake:</strong> <span id="matchStake"></span> GT each</p>
            <p><strong>Total Pot:</strong> <span id="totalPot"></span> GT</p>
            <p>
              <strong>Winner gets:</strong> <span id="winnerAmount"></span> GT
            </p>
          </div>

          <button id="confirmStake" class="btn btn-warning">
            Confirm & Stake GT Tokens
          </button>
          <button id="cancelMatch" class="btn btn-danger">Cancel Match</button>

          <div id="stakingStatus" class="status warning hidden">
            <span class="loading"></span>
            Waiting for both players to stake tokens...
          </div>
        </div>

        <!-- Game Play Section -->
        <div id="gamePlaySection" class="hidden">
          <div id="gameStatus" class="status info">Game starting...</div>

          <div class="match-info">
            <p><strong>Match ID:</strong> <span id="gameMatchId"></span></p>
            <p><strong>Your Symbol:</strong> <span id="playerSymbol"></span></p>
            <p><strong>Current Turn:</strong> <span id="currentTurn"></span></p>
          </div>

          <div class="game-board">
            <button class="cell" data-index="0"></button>
            <button class="cell" data-index="1"></button>
            <button class="cell" data-index="2"></button>
            <button class="cell" data-index="3"></button>
            <button class="cell" data-index="4"></button>
            <button class="cell" data-index="5"></button>
            <button class="cell" data-index="6"></button>
            <button class="cell" data-index="7"></button>
            <button class="cell" data-index="8"></button>
          </div>

          <button id="forfeitGame" class="btn btn-danger">Forfeit Game</button>
        </div>

        <!-- Game Result Section -->
        <div id="gameResultSection" class="hidden">
          <div id="resultStatus" class="status">Game completed!</div>

          <div class="match-info">
            <p><strong>Winner:</strong> <span id="gameWinner"></span></p>
            <p><strong>Payout:</strong> <span id="payoutAmount"></span> GT</p>
            <p>
              <strong>Transaction:</strong>
              <a id="txLink" href="#" target="_blank" class="tx-link"
                >View on Explorer</a
              >
            </p>
          </div>

          <button id="playAgain" class="btn btn-success">
            Play Another Game
          </button>
        </div>
      </div>
    </div>

    <script src="unified-tictactoe.js"></script>
  </body>
</html>
